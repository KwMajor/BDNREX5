import unittest
from unittest.mock import MagicMock
from controllers.usuario_controller import UsuarioController

class TestUsuarioController(unittest.TestCase):
    def setUp(self):
        # Criamos um "fake" do banco de dados para não precisar de uma conexão real
        self.mock_db = MagicMock()
        self.controller = UsuarioController(self.mock_db)

    def test_criar_usuario_sucesso(self):
        # Simulamos o que o banco de dados deveria retornar
        dados_usuario = {
            'id': '123',
            'nome': 'Teste',
            'email': 'teste@email.com',
            'telefone': '123456789'
        }
        
        # Configuramos o mock para retornar o usuário quando execute_write for chamado
        self.mock_db.execute_write.return_value = {'u': dados_usuario}

        resultado = self.controller.criar_usuario("Teste", "teste@email.com", "123456789")

        # Verificações
        self.assertIsNotNone(resultado)
        self.assertEqual(resultado['nome'], "Teste")
        self.assertTrue(self.mock_db.execute_write.called)

    def test_buscar_usuario_nao_existente(self):
        # Simulamos que o banco não encontrou nada
        self.mock_db.execute_query.return_value = []

        resultado = self.controller.buscar_usuario("id-inexistente")

        self.assertIsNone(resultado)

if __name__ == '__main__':
    unittest.main()